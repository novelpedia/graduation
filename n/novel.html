<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link href="../css/novel_page.css" rel="stylesheet">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/footer.css" rel="stylesheet">
    <title>작품페이지</title>
    <style>

    </style>
</head>

<body>
    <header class="header">
        <a class="logo_a" href="../index.html">
            <!--<img class="logo" src="./image/novelpedia.png" height="40px">-->
            <img class="logo_icon" src="../image/logo.png">
        </a>
        <div class="first_line">
            <div class="inner_item">
                <a id="open_close" href="#" class="navbar_toggleBtn">
                    <img id="close" src="../image/메뉴_검정_버튼.png">
                </a>
                <div class="inner_inner_item">
                    <div class="search">
                        <div class="icon"></div>
                        <form method="get" action="../search.html">
                            <div class="input">
                                <input type="text" placeholder="Search" id="mysearch">
                            </div>
                            <span class="clear" onclick="document.getElementById('mysearch').value = ''"></span>
                            <input type="submit" value="" class="search_btn">
                        </form>
                    </div>
                </div>
            </div>
            <div class="set">
                <div class="set_mid">
                    <ul class="bar_menu">
                        <li><a href="../listpage.html">목록페이지</a></li>
                        <li class="mypage_header" id="mypage_button"><a href="../mypage">마이페이지</a></li>
                        <li><a href="../login" id="login_logout">Login</a></li>
                    </ul>
                </div>
            </div>
        </div>

    </header>

    <script>
        /*메뉴버튼 바꾸기 위한 변수*/
        const change_img = document.createElement('img');
        change_img.setAttribute('src', './image/메뉴_닫힘.png');
        change_img.setAttribute('id', 'close');

        const change_img_normal = document.createElement('img');
        change_img_normal.setAttribute('src', './image/메뉴_검정_버튼.png');
        change_img_normal.setAttribute('id', 'close');

        /*검색버튼에 대한 동작 변수*/
        const icon = document.querySelector('.search .icon');
        const search = document.querySelector('.search');
        const inner_item = document.querySelector('.inner_item');
        const inner_inner_item = document.querySelector('.inner_inner_item');
        const menu_window2 = document.querySelector('.header .set active');

        /*메뉴 버튼에 따른 동작 변수*/
        const toggleBtn = document.querySelector('.navbar_toggleBtn');
        const menu = document.querySelector('.bar_menu');
        const menu_window = document.querySelector('.header .set');

        /*메뉴버튼*/
        toggleBtn.onclick = function() {
            menu.classList.toggle('active');
            menu_window.classList.toggle('active');
            const lastDiv = document.getElementById('close');
            /*메뉴창 열림 여부에 따라 버튼 이미지 교체*/
            if (document.querySelector('.header .set').classList.contains('active')) {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img);
            } else {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img_normal);
            }

        }

        /*검색버튼*/
        icon.onclick = function() {
            icon.classList.toggle('active');
            search.classList.toggle('active');
            inner_item.classList.toggle('active');
            inner_inner_item.classList.toggle('active');
            menu_window.classList.toggle('search_active');
        }
    </script>

    <section class="section_empty" id="section_empty">
        <div id="empty"></div>
    </section>

    <section class="document_section" id="document_section">
        <div class="document_section_all">
            <!--작품 제목(작가명)-->
            <div class="document_name">
                <a href="#" id="document_name">작품제목(작가명)</a>
            </div>

            <div class="document_bundle_button">
                <a class="edit" href="../e" id="go_edit">편집</a>
                <a class="history" href="../h" id="go_history">역사</a>
                <a class="delete" href="#">삭제</a>
            </div>

            <div class="document_bundle">
                <div class="document_bundle_cover">
                    <!--작품표지-->
                    <div class="document_bookcover">
                        <img id="document_bookcover" src="../image/표지_미등록.png">
                    </div>

                    <!--관심등록 및 버튼-->
                    <div class="document_button">
                        <button>좋아요</button>
                    </div>
                </div>


                <!--목차-->
                <div class="document_index">
                    <ol>목차
                        <li><a href="#document_information">작품정보</a></li>
                        <li><a href="#document_summary">줄거리</a></li>
                        <li><a href="#document_review">리뷰</a></li>
                        <li><a></a></li>
                        <li><a></a></li>
                    </ol>
                </div>
            </div>

            <!--작품정보 : 표-->
            <div id="document_information" class="document_information">
                <table>
                    <tr>
                        <th colspan="2">작품정보</th>
                    </tr>
                    <!--Work Info-->
                    <tr>
                        <td class="title">제목</td>
                        <td class="content" id="document_information_title"></td>
                    </tr>

                    <tr>
                        <td class="title">작가</td>
                        <td class="content"><a href="../author.html" id="document_information_author"></a></td>
                    </tr>

                    <tr>
                        <td class="title">출판사</td>
                        <td class="content"><a href="../publisher.html" id="document_information_publisher"></a></td>
                    </tr>

                    <tr>
                        <td class="title">장르</td>
                        <td class="content" id="document_information_genre"></td>
                    </tr>

                    <tr>
                        <td class="title">구매처 및 연재처</td>
                        <td class="content"><a href="https://yes24.com" target="_blank" id="document_information_buy_series">Yes24</a></td>
                    </tr>

                    <tr>
                        <td class="title">출간일</td>
                        <td class="content" id="document_information_publish_date">2022-08-04</td>
                    </tr>
                </table>
            </div>

            <!--줄거리-->
            <div id="document_summary" class="document_summary">
                <div class="title">
                    <p class="p_title">줄거리</p>
                </div>
                <input type="checkbox" class="read_more" id="more" />
                <!--<div class="lable_Square"></div>-->

                <div class="content" id="summary_content">
                    <p id="document_summary_content">
                    </p>
                </div>
                <label for="more" class="trigger" id="more_button"></label>
            </div>

            <!--리뷰-->
            <!--<h1>리뷰</h1>-->
            <div id="document_review" class="document_review">
                <div class="title">
                    <p class="p_title">리뷰</p>
                </div>
                <div class="content">
                    <div class="box_estimate">
                        <div class="document_500char">
                            <span class="document_500char_name">500자평</span>
                        </div>
                        <form>
                            <div class="content_input">
                                <div class="star_box">
                                    <div class="star">
                                        <input type="radio" name="rating" value="5" id="rate1"><label for="rate1">★</label>
                                        <input type="radio" name="rating" value="4" id="rate2"><label for="rate2">★</label>
                                        <input type="radio" name="rating" value="3" id="rate3"><label for="rate3">★</label>
                                        <input type="radio" name="rating" value="2" id="rate4"><label for="rate4">★</label>
                                        <input type="radio" name="rating" value="1" id="rate5"><label for="rate5">★</label>
                                    </div>
                                </div>
                                <div class="content_boxing">
                                    <textarea id="char_content" onkeydown="calc()" onkeyup="calc()" onkeypress="calc()" maxlength="500"></textarea>
                                    <div class="register_button">
                                        <input class="register_submit" type="submit" value="등록">
                                    </div>
                                </div>
                                <div class="char_number">
                                    <input type="number" id="char_result" value="0" readonly>
                                    <span class="max_number">/ 500</span>
                                </div>
                            </div>
                        </form>

                        <div class="review_button">
                            <a href="#" class="review_write">리뷰작성</a>
                        </div>
                    </div>

                    <script>
                        function calc() {
                            document.getElementById('char_result').value = document.getElementById('char_content').value.length;
                        }
                    </script>
                    <div class="line">
                    </div>
                    <div class="review_pre">
                        <div class="review_pre_set">
                            <p>닉네임</p>
                            <p>|</p>
                            <p>평점</p>
                            <div class="balloon">
                                <p>리뷰</p>
                            </div>
                        </div>
                    </div>
                    <div class="review_pre">
                        <div class="review_pre_set">
                            <p>닉네임</p>
                            <p>|</p>
                            <p>평점</p>
                            <div class="balloon">
                                <p>리뷰</p>
                            </div>
                        </div>
                    </div>
                    <div class="review_pre">
                        <div class="review_pre_set">
                            <p>닉네임</p>
                            <p>|</p>
                            <p>평점</p>
                            <div class="balloon">
                                <p>리뷰</p>
                            </div>
                        </div>
                    </div>
                    <div class="review_pre">
                        <div class="review_pre_set">
                            <p>닉네임</p>
                            <p>|</p>
                            <p>평점</p>
                            <div class="balloon">
                                <p>리뷰</p>
                            </div>
                        </div>
                    </div>
                    <div class="review_pre">
                        <div class="review_pre_set">
                            <p>닉네임</p>
                            <p>|</p>
                            <p>평점</p>
                            <div class="balloon">
                                <p>리뷰</p>
                            </div>
                        </div>
                    </div>
                    <div class="review_pre">
                        <div class="review_pre_set">
                            <p>닉네임</p>
                            <p>|</p>
                            <p>평점</p>
                            <div class="balloon">
                                <p>리뷰</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!--구분선-->
            <!--안내-->
            <div class="alram">
                <p>※여기부터는 사용자가 직접 편집할 수 있는 공간입니다※</p>
            </div>

            <!--기타-->
            <div class="document_other">
                <p id="document_other">
                </p>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col">
                    <ul>
                        <li><a href="#">공지사항</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <ul>
                        <li><a href="#">Q&A</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <ul>
                        <li><a href="#">의견보내기</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>


    

    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="../js/information.js"></script>

    <!--로그인 상태 체크-->
    <script src="../js/login_check.js"></script>
    <!--로그아웃을 위한 소스코드-->
    <script src="../js/logout.js"></script>
    <!--로그아웃 상태일 때-->
    <script src="../js/logout_state.js"></script>


    <script>
        const path_url = window.location.pathname;
        const path_decode = decodeURI(path_url);
        // const temp = decodeURI("%EB%A9%94%EB%89%B4_%EB%8B%AB%ED%9E%");
        // console.log(temp);
        // console.log(path_url);
        // console.log(path_decode);
        const document_name = path_decode.split('/');
        document.getElementById('document_name').innerText = document_name[2];

        db.collection('novel_document').doc(document_name[2]).get().then((결과) => {
            // 불러온 내용 바탕으로 내용 바꾸기
            console.log(결과.data())
            
            // DB에 저장되어있는 내용 가져와서 DB에 저장
            var document_bookcover = 결과.data().bookcover;
            var document_information_title = 결과.data().name;
            var document_information_publisher = 결과.data().publisher;
            var document_information_author = 결과.data().author;
            var document_information_genre = 결과.data().genre;
            var document_information_buy_series_name = 결과.data().buy_series;
            var document_information_buy_series_address = 결과.data().address;
            var document_information_publish_date = 결과.data().publish_date;
            var document_summary_content = 결과.data().summary;
            
            
            // 추후에 입력, 순서대로 좋아요개수, 업로드 날짜, 조회수, 태그, 기타
            var document_like = 결과.data().like;
            var document_upload_date = 결과.data().upload_date;
            var document_view = 결과.data().view;
            var document_tag = 결과.data().tag;
            var document_other = 결과.data().other;

            // 줄거리 더보기 버튼 제거
            if(document_summary_content.length<850){
                document.getElementById("more_button").style.display = 'none';
                document.getElementById("summary_content").style.borderBottomRightRadius = '15px';
                document.getElementById("summary_content").style.borderBottomLeftRadius = '15px';
            }

            // 타이틀 변경
            document.title = document_name[2];
            
            // 편집, 역사 페이지 버튼 주소 초기화
            document.getElementById("go_edit").href = "../e/" + document_name[2];
            document.getElementById("go_history").href = "../h/" + document_name[2];

            // 표지변경
            console.log(document_bookcover);
            document.getElementById("document_bookcover").src = document_bookcover;

            document.getElementById("document_information_title").innerText = document_information_title;
            document.getElementById("document_information_author").innerText = document_information_author;
            document.getElementById("document_information_author").href = '../a/' + document_information_author;
            document.getElementById("document_information_publisher").innerText = document_information_publisher;
            document.getElementById("document_information_publisher").href = '../p/' + document_information_publisher;

            document.getElementById("document_information_genre").innerText = document_information_genre;
            
            document.getElementById("document_information_buy_series").innerText = document_information_buy_series_name;

            const address_analze = document_information_buy_series_address.split(":");
            console.log(address_analze[0]);

            if(address_analze[0]==="http" || address_analze[0]==="https"){
                document.getElementById("document_information_buy_series").href = document_information_buy_series_address;
            }
            else{
                document.getElementById("document_information_buy_series").href = "https://www.google.com/search?q=" + document_information_buy_series_address;
            }

            document.getElementById("document_information_publish_date").innerText = document_information_publish_date;
            document.getElementById("document_summary_content").innerText = document_summary_content;

            document.getElementById("document_other").innerText = document_other;
            // document.getElementById("document_information_author").innerText = document_information_author;
            // document.getElementById("document_information_author").innerText = document_information_author;
            // document.getElementById("document_information_author").innerText = document_information_author;
        }).catch((err) => {
            console.log(err);
            document.getElementById("document_section").style.display = "none";
            const empty = `<div class="empty_page"> <div class="empty_result_area"> <div class="empty_none">
                    <div class="text_bundle">
                        <p class="warning">ⓘ</p><p id ="this_document">해당문서</p><p class="alram">에 대한 문서 정보가 없습니다.</p>
                    </div>
                    <div class="button_bundle">
                        <a href="#" class="new_document" id="new_document">새 문서 작성하기</a>
                        <a href="#" class="history">역사</a>
                    </div>
                </div>
            </div></div>`
            
            document.getElementById('section_empty').style.display = 'block';
            document.getElementById('empty').innerHTML = empty;
            document.getElementById('this_document').innerText = document_name[2];
            document.getElementById('new_document').href = '../e/' + document_name[2];
        });
    </script>

    <style>
        .section_empty {
            margin-top: 100px;
            margin-bottom: 100px;
            width: 100%;
            display: none;
        }

        .empty_page {
            width: auto;
            height: auto;
            margin-left: 150px;
            margin-right: 150px;
        }

        #empty{
            
        }

        .empty_result_area {
            min-height: 600px;
            height: auto;
            border: 1px solid black;
            /*background-color: #f7fbfc;*/
        }
        .empty_none {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin-left: 20px;
            margin-right: 20px;
            margin-top: 15px;
            width: auto;
            height: 100px;
            border: 1px solid #e5e5e5;
            background-color:#f6f6f6;
        }

        .empty_none .button_bundle {
            display: flex;
            justify-content: flex-end;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .empty_none .text_bundle {
            display: flex;
        }

        .empty_none a {
            text-decoration: none;
            padding: 5px;
            padding-left: 30px;
            padding-right: 30px;
            margin: 0;
            font-size: 15px;
            font-weight: 600;
            border: 1px solid #c7c3c3;
            color: gray;
            background-color: #fff;
        }

        .empty_none .new_document {
            color: #769fcd;
        }

        .empty_none .history {
            border-left: none;
            color: #1fa73b;
        }

        .empty_none p {
            margin-bottom: 5px;
            margin-left: 5px;
            margin-top: 10px;
        }

        .empty_none .alram {
            margin-left: 0px;
        }

        .empty_none .warning {
            font-weight: 600;
            margin-top: 11px;
            transform: rotate(180deg);
        }

        @media (max-width: 870px){
            .empty_page {
                margin-left: 30px;
                margin-right: 30px;
           }
        }
    </style>
    

</body>

</html>