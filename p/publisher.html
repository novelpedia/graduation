<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link href="../css/publisher_page.css" rel="stylesheet">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/footer.css" rel="stylesheet">
    <link href="../css/getOther.css" rel="stylesheet">
    <link href="../css/loading.css" rel="stylesheet">
    <title>ì¶œíŒì‚¬í˜ì´ì§€</title>
</head>

<body>
    <header class="header">
        <a class="logo_a" href="../index.html">
            <!--<img class="logo" src="./image/novelpedia.png" height="40px">-->
            <img class="logo_icon" src="../image/logo.png">
        </a>
        <div class="first_line">
            <div class="inner_item">
                <a id="open_close" href="#" class="navbar_toggleBtn">
                    <img id="close" src="../image/ë©”ë‰´_ê²€ì •_ë²„íŠ¼.png">
                </a>
                <div class="inner_inner_item">
                    <div class="search">
                        <div class="icon"></div>
                        <form method="get" action="../search">
                            <div class="input">
                                <input type="text" placeholder="Search" id="mysearch" name="q">
                            </div>
                            <span class="clear" onclick="document.getElementById('mysearch').value = ''"></span>
                            <input type="submit" value="" class="search_btn">
                        </form>
                    </div>
                </div>
            </div>
            <div class="set">
                <div class="set_mid">
                    <ul class="bar_menu">
                        <input type="checkbox" id="list_open">
                        <label for="list_open" class="list_page_label">
                            <li class="list_li">ëª©ë¡í˜ì´ì§€</li>
                            <div class="header_list">
                                <div class="header_set1">
                                    <div class="header_picture"><a href="../list/novel">ì‘í’ˆ</a></div>
                                </div>
                                <div class="header_set1">
                                    <div class="header_author"><a href="../list/author">ì‘ê°€</a></div>
                                </div>
            
                                <div class="header_set1">
                                    <div class="header_publisher"><a href="../list/publisher">ì¶œíŒì‚¬</a></div>
                                </div>
                            </div>
                        </label>
                        <li class="mypage_header" id="mypage_button"><a href="../mypage">ë§ˆì´í˜ì´ì§€</a></li>
                        <li><a href="../login" id="login_logout">Login</a></li>
                    </ul>
                </div>
            </div>
        </div>

    </header>

    <script>
        /*ë©”ë‰´ë²„íŠ¼ ë°”ê¾¸ê¸° ìœ„í•œ ë³€ìˆ˜*/
        const change_img = document.createElement('img');
        change_img.setAttribute('src', '../image/ë©”ë‰´_ë‹«í˜.png');
        change_img.setAttribute('id', 'close');

        const change_img_normal = document.createElement('img');
        change_img_normal.setAttribute('src', '../image/ë©”ë‰´_ê²€ì •_ë²„íŠ¼.png');
        change_img_normal.setAttribute('id', 'close');

        /*ê²€ìƒ‰ë²„íŠ¼ì— ëŒ€í•œ ë™ì‘ ë³€ìˆ˜*/
        const icon = document.querySelector('.search .icon');
        const search = document.querySelector('.search');
        const inner_item = document.querySelector('.inner_item');
        const inner_inner_item = document.querySelector('.inner_inner_item');
        const menu_window2 = document.querySelector('.header .set active');

        /*ë©”ë‰´ ë²„íŠ¼ì— ë”°ë¥¸ ë™ì‘ ë³€ìˆ˜*/
        const toggleBtn = document.querySelector('.navbar_toggleBtn');
        const menu = document.querySelector('.bar_menu');
        const menu_window = document.querySelector('.header .set');

        /*ë©”ë‰´ë²„íŠ¼*/
        toggleBtn.onclick = function() {
            menu.classList.toggle('active');
            menu_window.classList.toggle('active');
            const lastDiv = document.getElementById('close');
            /*ë©”ë‰´ì°½ ì—´ë¦¼ ì—¬ë¶€ì— ë”°ë¼ ë²„íŠ¼ ì´ë¯¸ì§€ êµì²´*/
            if (document.querySelector('.header .set').classList.contains('active')) {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img);
            } else {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img_normal);
            }

        }

        /*ê²€ìƒ‰ë²„íŠ¼*/
        icon.onclick = function() {
            icon.classList.toggle('active');
            search.classList.toggle('active');
            inner_item.classList.toggle('active');
            inner_inner_item.classList.toggle('active');
            menu_window.classList.toggle('search_active');
        }
    </script>

    <div class="loading_box" id="loading_box">
        <div class="loading-container">
            <div class="loading"></div>
            <div id="loading-text">loading</div>
        </div>
    </div>

    <section class="section_empty" id="section_empty">
        <div id="empty"></div>
    </section>

    <section class="document_section" id="document_section">
        <div class="document_section_all">
            <!--ì¶œíŒì‚¬ì´ë¦„(ì„¤ë¦½ì—°ë„)-->
            <div class="document_name">
                <a href="#" id="document_name">ì¶œíŒì‚¬ì´ë¦„(ì„¤ë¦½ë…„ë„)</a>
            </div>

            <div class="document_bundle_button">
                <a class="edit" id="go_edit" href="../ep">í¸ì§‘</a>
                <a class="history" id="go_history" href="../h">ì—­ì‚¬</a>
                <a class="delete" id="go_delete">ì‚­ì œ</a>
            </div>

            <div class="document_view_update">
                <div class="view_block">
                    <span id="view_name">ì¡°íšŒìˆ˜ :</span>
                    <span id="view_get"></span>
                </div>
                <span class="sl">/</span>
                <div class="update_block">
                    <span id="update_name">ìµœì¢… ìˆ˜ì • :</span>
                    <span id="update_get"></span>
                </div>
            </div>

            <div class="document_bundle">
                <div class="document_bundle_cover">
                    <!--ì‘í’ˆí‘œì§€-->
                    <div class="document_profile_image">
                        <img id="document_profile_image_cover" src="../image/í‘œì§€_ë¯¸ë“±ë¡.png">
                        <!--ê´€ì‹¬ë“±ë¡ ë° ë²„íŠ¼-->
                        <div class="document_button">
                            <input type="checkbox" id="like_button" style="display: none;">
                            <label class="like" for="like_button" onclick="like()">ì¢‹ì•„ìš”</label>
                            <label class="heart" for="like_button" onclick="like()">â™¥</label>
                            <label class="like_count" id="like_count">0</label>
                        </div>
                    </div>
                </div>

                <!--ëª©ì°¨-->
                <div class="document_index">
                    <ol>ëª©ì°¨
                        <li><a href="#document_information">ì¶œíŒì‚¬ì •ë³´</a></li>
                        <li><a href="#document_novel_list">ì‘í’ˆëª©ë¡</a></li>
                        <li><a href="#document_other">ì‚¬ìš©ìí¸ì§‘</a></li>
                    </ol>
                </div>
            </div>

            <!--ì‘í’ˆì •ë³´ : í‘œ-->
            <div id="document_information" class="document_information">
                <table>
                    <tr>
                        <th colspan="2">ì¶œíŒì‚¬ì •ë³´</th>
                    </tr>
                    <!--Work Info-->
                    <tr>
                        <td class="title">ì´ë¦„</td>
                        <td class="content" id="document_information_name">ì¶œíŒì‚¬ì´ë¦„</td>
                    </tr>
                    <tr>
                        <td class="title">ì„¤ë¦½ì¼</td>
                        <td class="content" id="document_information_establishdate">2022.09.27</td>
                    </tr>

                    <tr>
                        <td class="title">ìœ„ì¹˜</td>
                        <td class="content"><a href="#" id="document_information_location" target="_blank">ê²½ê¸°ë„ íŒŒì£¼ì‹œ</a></td>
                    </tr>

                    <tr>
                        <td class="title">í™ˆí˜ì´ì§€</td>
                        <td class="content"><a href="#" id="document_information_homepage" target="_blank">ë°”ë¡œê°€ê¸°ë§í¬</a></td>
                    </tr>
                </table>
            </div>

            <!-- íƒœê·¸ì˜ì—­ -->
            <div class="document_tag_area" id="document_tag_area">

            </div>

            <!--ì‘í’ˆ ëª©ë¡-->
            <div id="document_novel_list" class="document_novel_list">
                <div class="title">
                    <p class="p_title">ì‘í’ˆëª©ë¡</p>
                </div>
                <div class="content">
                    <div class="document_first" id="publisher_document">
                        <!-- <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div> -->
                    </div>
                </div>
            </div>
            
            <!--ì‘ê°€ ëª©ë¡-->
            <!-- <div id="document_author_list" class="document_author_list">
                <div class="title">
                    <p class="p_title">ì‘ê°€ëª©ë¡</p>
                </div>
                <div class="content">
                    <div class="document_first">
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                        <div class="document_list">
                            <a href="#">
                                <img src="./image/í‘œì§€_ë¯¸ë“±ë¡.png">
                                <p>ì†Œì„¤ì œëª©</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div> -->

            <!--ì•ˆë‚´-->
            <div class="alram">
                <p>â€»ì—¬ê¸°ë¶€í„°ëŠ” ì‚¬ìš©ìê°€ ì¶”ê°€í•œ ë‚´ìš©ì…ë‹ˆë‹¤â€»</p>
            </div>

            <!--ê¸°íƒ€-->
            <div class="document_other" id="document_other">

            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col">
                    <ul>
                        <li><a href="../notice">ê³µì§€ì‚¬í•­</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <ul>
                        <li><a href="../report">ì‹ ê³  ë° ê±´ì˜</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="../js/information.js"></script>

    <!--ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬-->
    <script src="../js/login_check.js"></script>
    <!--ë¡œê·¸ì•„ì›ƒì„ ìœ„í•œ ì†ŒìŠ¤ì½”ë“œ-->
    <script src="../js/logout.js"></script>
    <!--ë¡œê·¸ì•„ì›ƒ ìƒíƒœì¼ ë•Œ-->
    <script src="../js/logout_state.js"></script>

    <script>
        const path_url = window.location.pathname;
        const path_decode = decodeURI(path_url);
        const document_name = path_decode.split('/');

        // íƒ€ì´í‹€ ë³€ê²½
        document.title = document_name[2];
            
        // í¸ì§‘, ì—­ì‚¬ í˜ì´ì§€ ë²„íŠ¼ ì£¼ì†Œ ì´ˆê¸°í™”
        document.getElementById("go_edit").href = "../ep/" + document_name[2];
        document.getElementById("go_history").href = "../h/" + document_name[2];
    </script>

    <!-- ë¬¸ì„œ ì—´ë©´ì„œ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•  í•¨ìˆ˜ -->
    <script>
        async function start_author(){
                $('#loading_box').show()
                await getUser();
                await getInformation();
                // console.log(login_user_information);
                $('#loading_box').hide()
            }

        start_author();
    </script>

    <!-- ì¢‹ì•„ìš” -->
    <script>
        async function getInformation() {
            // console.log("loging : " + login_user_information);
            const getDocRef = db.collection('user').doc(login_user_information).collection('like').doc(document_name[2]);
            try{
                const doc = await getDocRef.get();
                if (doc.exists) {
                    // ì´ë¯¸ ì¢‹ì•„ìš” ëª©ë¡ì— ìˆëŠ” ê²½ìš°
                    // console.log("exists true");
                    document.getElementById('like_button').checked = true;
                    like_state = true;
                } else {
                    // ì¢‹ì•„ìš” ëª©ë¡ì— ì—†ëŠ” ê²½ìš°
                    // console.log("exists false");
                    like_state = false;
                }
            }
            catch(error){
                console.log('Error getting document:', error);
            }
        }

        function like(){
            if(login_check == true){
                if(like_state == true) {
                    $('#loading_box').show()
                    // ì´ë¯¸ ì¢‹ì•„ìš” ëª©ë¡ì— ìˆëŠ” ê²½ìš°
                    db.collection('user').doc(login_user_information).collection('like').doc(document_name[2]).delete().then(function() {
                        likeDimCounter();
                        history_likeDimCounter();
                        // console.log("ë¬¸ì„œ ì‚­ì œ ì™„ë£Œ");
                        like_state = false;
                        $('#loading_box').hide()
                    }).catch(function(error) {
                        console.error("Error removing document: ", error);
                        $('#loading_box').hide()
                    });
                } else {
                    $('#loading_box').show()
                    // ì¢‹ì•„ìš” ëª©ë¡ì— ì—†ëŠ” ê²½ìš°
                    var info = {
                        name: document_name[2],
                        date: new Date(),
                        classification: "p"
                    };
                    db.collection('user').doc(login_user_information).collection('like').doc(document_name[2]).set(info).then((result) => {
                        likeIncCounter();
                        history_likeIncCounter();
                        // alert("ì¶”ê°€ ì™„ë£Œ");
                        like_state = true;
                        $('#loading_box').hide()
                    }).catch((error) => {
                        alert("failed.", error);
                        $('#loading_box').hide()
                    });
                }
            }
            else{
                alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”");
                document.getElementById("like_button").checked = true;
            }
        }

        // ì¢‹ì•„ìš” ì¶”ê°€ ì—…ë°ì´íŠ¸
        function likeIncCounter(){
            const docRef = db.collection('publisher_document').doc(document_name[2]);
            return docRef.update({
                like: firebase.firestore.FieldValue.increment(1),
            }).then(() => {
                // console.log("ì¢‹ì•„ìš” ì¦ê°€ ì„±ê³µ");
                document.getElementById("like_count").innerText = Number($("label[id='like_count']").text()) + 1;
            }).catch((error) => {
                console.log(error);
            });
        }

        // ì¢‹ì•„ìš” ì œê±° ì—…ë°ì´íŠ¸
        function likeDimCounter(){
            const docRef = db.collection('publisher_document').doc(document_name[2]);
            return docRef.update({
                like: firebase.firestore.FieldValue.increment(-1),
            }).then(() => {
                document.getElementById("like_count").innerText = Number($("label[id='like_count']").text()) - 1;
                // console.log("ì¢‹ì•„ìš” ì œê±° ì„±ê³µ");
            }).catch((error) => {
                console.log(error);
            });
        }

        // ì—­ì‚¬ data ì»¬ë ‰ì…˜ ì¢‹ì•„ìš” ì¦ê°€ ì—…ë°ì´íŠ¸
        function history_likeIncCounter(){
            const docRef = db.collection('history').doc(document_name[2]).collection('data').doc('count');
            return docRef.update({
                like: firebase.firestore.FieldValue.increment(1),
            }).then(() => {
                // console.log("ì—­ì‚¬ ì¢‹ì•„ìš” ì¦ê°€ ì„±ê³µ");
            }).catch((error) => {
                console.log(error);
            });
        }

        // ì—­ì‚¬ data ì»¬ë ‰ì…˜ ì¢‹ì•„ìš” ê°ì†Œ ì—…ë°ì´íŠ¸
        function history_likeDimCounter(){
            const docRef = db.collection('history').doc(document_name[2]).collection('data').doc('count');
            return docRef.update({
                like: firebase.firestore.FieldValue.increment(-1),
            }).then(() => {
                // console.log("ì—­ì‚¬ ì¢‹ì•„ìš” ì œê±° ì„±ê³µ");
            }).catch((error) => {
                console.log(error);
            });
        }
    </script>

    <!-- History count ê°€ì ¸ì˜¤ê¸°-->
    <script>
        async function getHistory(){
            var historyPath = db.collection("history").doc(document_name[2]).collection("data").doc("count");
            await historyPath.get().then((ê²°ê³¼) => {
                document.getElementById("view_get").innerText = ê²°ê³¼.data().view + "íšŒ";
                document.getElementById("update_name").innerText = "ìˆ˜ì • ì¼ì‹œ : ";
                document.getElementById("like_count").innerText = ê²°ê³¼.data().like;
            }).catch((err)=>{
                console.log("ì—­ì‚¬_ì¹´ìš´íŠ¸_ë¡œë“œ ì‹¤íŒ¨" + err);
            });
        }
    </script>

    <!-- ì¡°íšŒìˆ˜ -->
    <script>
        var ip_address_info;
        var cookie_name;
        if(document_name[1]=="hp"){
            window.addEventListener("load", async function() { //ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
                $('#loading_box').show();
                await data_loading();
                await getHistory();
                $('#loading_box').hide()
            });
        }
        else{
            window.addEventListener("load", async function() { //ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
                $('#loading_box').show()
                await data_loading();
                await getCookie();
                $('#loading_box').hide()
                // countSpan.textContent = view;       
            });

            
        }

        $.getJSON("https://ipinfo.io", function(data) {
            ip_address_info = data.ip;
            //setCookie í•¨ìˆ˜ë¥¼ ì½œë°± ì•ˆì—ì„œ í˜¸ì¶œ 
        })

        function setCookie(name, day) {
            var date = new Date();
            date.setDate(date.getDate() + day); //í•˜ë£¨ ë’¤ ë§Œë£Œ
                            
            var mycookie = '';
            mycookie += name //ì´ë¦„
            // mycookie += name + '=' + value + ';';
            mycookie += 'Expires=' + date.toUTCString(); //ë§Œë£Œ + ë¬¸ìí˜•ì‹ë³€í™˜
                            
            document.cookie = mycookie; //ì¿ í‚¤ ì„¤ì •, ìƒì„±

        }

        async function getCookie() {
            var cookies = document.cookie.split(';');
            // console.log(cookies);

            var currentCookie = document.cookie;
            var cookieCheck = currentCookie.indexOf(document_name[2]);
            // console.log(cookieCheck);

            if(cookieCheck > - 1){
                // console.log("ì´ë¯¸ ì¡°íšŒí•œ ê²Œì‹œë¬¼");
            }
            else {
                cookie_name = "NovelPedia" + document_name[2]
                await setCookie(cookie_name, 1);
                await viewIncCounter();
                await history_viewIncCounter();
                // console.log("ì²˜ìŒ ì¡°íšŒí•˜ëŠ” ê²Œì‹œë¬¼");
            }
        }

        async function viewIncCounter(){
            const docRef = db.collection('publisher_document').doc(document_name[2]);
            return await docRef.update({
                view: firebase.firestore.FieldValue.increment(1),
            }).then(() => {
                // console.log("ì¡°íšŒìˆ˜ ì¦ê°€ ì„±ê³µ");
                // history(document_bookcover);
                // console.log("Document successfully updated!");
            }).catch((error) => {
                console.log(error);
            });
        }

        // ì—­ì‚¬ ì½œë ‰ì…˜ì— ì¡°íšŒìˆ˜ ë°ì´í„° ì €ì¥
        async function history_viewIncCounter(){
            const docRef = db.collection('history').doc(document_name[2]).collection('data').doc('count');
            return await docRef.update({
                view: firebase.firestore.FieldValue.increment(1),
            }).then(() => {
                // console.log("ì—­ì‚¬ ì¡°íšŒìˆ˜ ì¦ê°€ ì„±ê³µ");
            }).catch((error) => {
                console.log(error);
            });
        }
     
    </script>

    <script>

        var docPath;
        let data_save_array = [];

        async function data_loading(){
            if(document_name[1]=="hp"){
                var path_url = window.location.search;
                var path_decode = decodeURI(path_url);
                var document_url_version = path_decode.split('v=');
                docPath = db.collection('history').doc(document_name[2]).collection('version').doc(document_url_version[1]);
                
                document.getElementById('go_delete').remove();
            }
            else{
                docPath = db.collection('publisher_document').doc(document_name[2]);
            }
            document.getElementById('document_name').innerText = document_name[2];

            await docPath.get().then((ê²°ê³¼) => {
                data_save_array = ê²°ê³¼;
                // ë¶ˆëŸ¬ì˜¨ ë‚´ìš© ë°”íƒ•ìœ¼ë¡œ ë‚´ìš© ë°”ê¾¸ê¸°
                // console.log(ê²°ê³¼.data())
                
                var document_profilecover = ê²°ê³¼.data().profilecover;
                var document_information_name = ê²°ê³¼.data().name;
                var document_information_establishdate = ê²°ê³¼.data().establishdate;
                var document_information_location = ê²°ê³¼.data().location;
                var document_information_homepage = ê²°ê³¼.data().homepage;
                
                
                // ì¶”í›„ì— ì…ë ¥, ìˆœì„œëŒ€ë¡œ ì¢‹ì•„ìš”ê°œìˆ˜, ì—…ë¡œë“œ ë‚ ì§œ, ì¡°íšŒìˆ˜, íƒœê·¸, ê¸°íƒ€
                var document_like = ê²°ê³¼.data().like;
                var document_update_date = ê²°ê³¼.data().update_date;
                var document_view = ê²°ê³¼.data().view;
                var document_tag = ê²°ê³¼.data().tag;
                var document_other = ê²°ê³¼.data().other;


                // íƒ€ì„ìŠ¤í…œí”„ ë³€í™˜
                var timestamp_second = document_update_date.seconds * 1000;
                var time = new Date(timestamp_second);
                var year = time.getFullYear().toString().slice(-4) + "ë…„ ";
                var month = ("0" + (time.getMonth() + 1)).slice(-2) + "ì›” ";
                var day = ("0" + time.getDate()).slice(-2) + "ì¼ ";
                var hour = ("0" + time.getHours()).slice(-2) + "ì‹œ ";
                var minute = ("0" + time.getMinutes()).slice(-2) + "ë¶„ ";
                var second = ("0" + time.getSeconds()).slice(-2) + "ì´ˆ";

                // í‘œì§€ë³€ê²½
                // console.log(document_bookcover);
                document.getElementById("document_profile_image_cover").src = document_profilecover;

                document.getElementById("document_information_name").innerText = document_information_name;
                document.getElementById("document_information_location").innerText = document_information_location;
                document.getElementById("document_information_establishdate").innerText = document_information_establishdate;
                document.getElementById("document_information_homepage").innerText = 'ğŸ”—';

                document.getElementById("view_get").innerText = document_view + "íšŒ";
                document.getElementById("update_get").innerText = year + month + day + hour + minute + second;
                document.getElementById("like_count").innerText = document_like;

                // íƒœê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì˜ì—­
                // console.log(typeof(document_tag));
                document_tag.forEach(function(tag_element){
                    var tag_temp = `<a href="../search?q=!${tag_element}">${"#"+tag_element}</a>`
                    $('#document_tag_area').append(tag_temp);
                });

                // ì¶œíŒì‚¬, ìµœê·¼ì‘í’ˆ, ëŒ€í‘œì‘í’ˆì€ ì‘í’ˆí˜ì´ì§€ë¡œ ì—°ê²°
                document.getElementById("document_information_location").href = 'https://www.google.com/maps/search/' + document_information_location;
                document.getElementById("document_information_homepage").href = document_information_homepage;
                
                // ì‚¬ìš©ì ì…ë ¥ ì˜ì—­ ë°›ê¸°
                document.getElementById("document_other").innerHTML = document_other;

                db.collection("novel_document").where("publisher", "==", document_information_name).orderBy("publish_date", "desc").get().then((ê²°ê³¼) => {
                    ê²°ê³¼.forEach((result) => {
                        var document_name_href = '../n/' + result.data().name + '(' +  result.data().author + ')';
                        var temp = 
                            `<div class="document_list">
                                <a href="${document_name_href}">
                                    <img src="${result.data().bookcover}">
                                    <p>${result.data().name}</p>
                                </a>
                            </div>`;
                        $('#publisher_document').append(temp);
                    });
                }).catch((err) => {
                        console.log(err);
                })
            }).catch((err) => {
                console.log(err);
                document.getElementById("document_section").style.display = "none";
                const empty = `<div class="empty_page"> <div class="empty_result_area"> <div class="empty_none">
                        <div class="text_bundle">
                            <p class="warning">â“˜</p><p id ="this_document">í•´ë‹¹ë¬¸ì„œ</p><p class="alram2">ì— ëŒ€í•œ ë¬¸ì„œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        <div class="button_bundle">
                            <a href="#" class="new_document" id="new_document">ìƒˆ ë¬¸ì„œ ì‘ì„±í•˜ê¸°</a>
                            <a href="#" class="history" id="history_document">ì—­ì‚¬</a>
                        </div>
                    </div>
                </div></div>`
                
                document.getElementById('section_empty').style.display = 'block';
                document.getElementById('empty').innerHTML = empty;
                document.getElementById('this_document').innerText = document_name[2];
                document.getElementById('new_document').href = '../ep/' + document_name[2];
                document.getElementById('history_document').href = '../h/' + document_name[2];
                
            });
        }
    </script>

    <script>
        var user_class = "nu";

        $('#go_delete').click(function(){
            if(confirm("ì •ë§ '" + document_name[2] + "'ë¬¸ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
                db.collection('publisher_document').doc(document_name[2]).delete().then(async function() {
                    if(login_check == true){
                        ip_address_info = user_id;
                        user_class = login_user_class;
                    }
                    await history_data_update();
                    await history_update();
                    // console.log("ë¬¸ì„œ ì‚­ì œ ì™„ë£Œ");
                }).catch(function(error) {
                    console.error("Error removing document: ", error);
                });
            }
            else{

            }
        });

        async function history_data_update(){
            return await db.collection('history').doc(document_name[2]).collection('data').doc('count').update({
                version: firebase.firestore.FieldValue.increment(1),
            })
            .then(async () => {
                // alert("history data ì—…ë°ì´íŠ¸ ì„±ê³µ!");                
            }).catch((err)=>{
                console.log(err + "history data ì—…ë°ì´íŠ¸ ì‹¤íŒ¨!")
            });
        }

        async function history_update(){
            var info = {
                profilecover: data_save_array.data().profilecover,
                name: data_save_array.data().name,
                name_keyword: data_save_array.data().name_keyword,
                establishdate: data_save_array.data().establishdate,
                location: data_save_array.data().location,
                homepage: data_save_array.data().homepage,
                tag: data_save_array.data().tag,
                other: data_save_array.data().other,
                the_first_date: data_save_array.data().the_first_date,
                version: data_save_array.data().version + 1,
                update_date:new Date(),
                category: data_save_array.data().category,
                final_modify: ip_address_info,
                user_class: user_class,
                action: "d",                               
            };
            // console.log(document_name[2]);
            await db.collection('history').doc(document_name[2]).collection('version').doc((data_save_array.data().version + 1).toString()).set(info).then((result) => {
                // console.log(result);
                // alert("history data success.");
                location.reload();
            }).catch((error) => {
                console.log(error);
                // alert("history data failed.");
            });

        }


    </script>

    <style>
        .section_empty {
            margin-top: 100px;
            margin-bottom: 100px;
            width: 100%;
            display: none;
        }

        .empty_page {
            width: auto;
            height: auto;
            margin-left: 150px;
            margin-right: 150px;
        }

        #empty{
            
        }

        .empty_result_area {
            min-height: 600px;
            height: auto;
            border: 1px solid black;
            /*background-color: #f7fbfc;*/
        }
        .empty_none {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin-left: 20px;
            margin-right: 20px;
            margin-top: 15px;
            width: auto;
            height: 100px;
            border: 1px solid #e5e5e5;
            background-color:#f6f6f6;
        }

        .empty_none .button_bundle {
            display: flex;
            justify-content: flex-end;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .empty_none .text_bundle {
            display: flex;
        }

        .empty_none a {
            text-decoration: none;
            padding: 5px;
            padding-left: 30px;
            padding-right: 30px;
            margin: 0;
            font-size: 15px;
            font-weight: 600;
            border: 1px solid #c7c3c3;
            color: gray;
            background-color: #fff;
        }

        .empty_none .new_document {
            color: #769fcd;
        }

        .empty_none .history {
            border-left: none;
            color: #1fa73b;
        }

        .empty_none p {
            margin-bottom: 5px;
            margin-left: 5px;
            margin-top: 10px;
        }

        .empty_none .alram2 {
            margin-left: 0px;
        }

        .empty_none .warning {
            font-weight: 600;
            margin-top: 11px;
            transform: rotate(180deg);
        }

        @media (max-width: 870px){
            .empty_page {
                margin-left: 30px;
                margin-right: 30px;
           }
        }
    </style>
</body>

</html>