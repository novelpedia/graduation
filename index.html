<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/header.css" rel="stylesheet">
    <link href="css/footer.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" sizes="512x512" href="android-chrome-512x512.png" />
    <title>노벨피디아</title>
</head>

<body class="main_body">
    <header class="header">
        <a class="logo_a" href="http://novelpedia.co.kr">
            <!--<img class="logo" src="./image/novelpedia.png" height="40px">-->
            <img class="logo_icon" src="image/logo.png">
        </a>
        <div class="first_line">
            <div class="inner_item">
                <a id="open_close" href="#" class="navbar_toggleBtn">
                    <img id="close" src="image/메뉴_검정_버튼.png">
                </a>
                <div class="inner_inner_item">
                    <div class="search">
                        <div class="icon"></div>
                        <form method="get" action="search">
                            <div class="input">
                                <input type="text" placeholder="Search" id="mysearch" name="q">
                            </div>
                            <span class="clear" onclick="document.getElementById('mysearch').value = ''"></span>
                            <input type="submit" value="" class="search_btn">
                        </form>
                    </div>
                </div>
            </div>
            <div class="set">
                <div class="set_mid">
                    <ul class="bar_menu">
                        <input type="checkbox" id="list_open">
                        <label for="list_open" class="list_page_label">
                            <li class="list_li">목록페이지</li>
                            <div class="header_list">
                                <div class="header_set1">
                                    <div class="header_picture"><a href="list/novel">작품</a></div>
                                </div>
                                <div class="header_set1">
                                    <div class="header_author"><a href="list/author">작가</a></div>
                                </div>
            
                                <div class="header_set1">
                                    <div class="header_publisher"><a href="list/publisher">출판사</a></div>
                                </div>
                            </div>
                        </label>
                        <li class="mypage_header" id="mypage_button"><a href="mypage">마이페이지</a></li>
                        <li><a href="login" id="login_logout">Login</a></li>
                    </ul>
                </div>
            </div>
        </div>

    </header>

    <script>
        /*메뉴버튼 바꾸기 위한 변수*/
        const change_img = document.createElement('img');
        change_img.setAttribute('src', './image/메뉴_닫힘.png');
        change_img.setAttribute('id', 'close');

        const change_img_normal = document.createElement('img');
        change_img_normal.setAttribute('src', './image/메뉴_검정_버튼.png');
        change_img_normal.setAttribute('id', 'close');

        /*검색버튼에 대한 동작 변수*/
        const icon = document.querySelector('.search .icon');
        const search = document.querySelector('.search');
        const inner_item = document.querySelector('.inner_item');
        const inner_inner_item = document.querySelector('.inner_inner_item');
        const menu_window2 = document.querySelector('.header .set active');

        /*메뉴 버튼에 따른 동작 변수*/
        const toggleBtn = document.querySelector('.navbar_toggleBtn');
        const menu = document.querySelector('.bar_menu');
        const menu_window = document.querySelector('.header .set');

        /*메뉴버튼*/
        toggleBtn.onclick = function() {
            menu.classList.toggle('active');
            menu_window.classList.toggle('active');
            const lastDiv = document.getElementById('close');
            /*메뉴창 열림 여부에 따라 버튼 이미지 교체*/
            if (document.querySelector('.header .set').classList.contains('active')) {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img);
            } else {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img_normal);
            }

        }

        /*검색버튼*/
        icon.onclick = function() {
            icon.classList.toggle('active');
            search.classList.toggle('active');
            inner_item.classList.toggle('active');
            inner_inner_item.classList.toggle('active');
            menu_window.classList.toggle('search_active');
        }
    </script>


    <section class="main_section">
        <div class="main_first">
            <div class="main_slideboard">
                <input type="radio" name="slide" id="slide01" checked>
                <input type="radio" name="slide" id="slide02">
                <input type="radio" name="slide" id="slide03">
                <input type="radio" name="slide" id="slide04">
                <div class="slidewrap">
                    <ul class="slidelist">
                        <!-- 슬라이드 영역 -->
                        <li class="slideitem">
                            <a href="https://novelpedia.co.kr/notice_view.html?page=1" target="_blank" title="사용방법 보러가기">
                                <!--<div class="textbox">
                                    <h3>첫번째 슬라이드</h3>
                                    <p>첫번째 슬라이드 입니다.</p>
                                </div>-->
                                <img src="./image/banner_6.png">
                            </a>
                        </li>
                        <li class="slideitem">
                            <a href="#" target="_blank">

                                <div class="textbox">
                                    <h3>두번째 슬라이드</h3>
                                    <p>두번째 슬라이드 입니다.</p>
                                </div>
                                <img src="./image/slide2.jpg">
                            </a>
                        </li>
                        <li class="slideitem">
                            <a href="#" target="_blank">

                                <div class="textbox">
                                    <h3>세번째 슬라이드</h3>
                                    <p>세번째 슬라이드 입니다.</p>
                                </div>
                                <img src="./image/slide.jpg">
                            </a>
                        </li>
                        <li class="slideitem">
                            <a href="#" target="_blank">

                                <div class="textbox">
                                    <h3>네번째 슬라이드</h3>
                                    <p>네번째 슬라이드 입니다.</p>
                                </div>
                                <img src="./image/slide.jpg">
                            </a>
                        </li>

                        <!-- 좌,우 슬라이드 버튼 -->
                        <div class="slide-control">
                            <div>
                                <label for="slide04" class="left"></label>
                                <label for="slide02" class="right"></label>
                            </div>
                            <div>
                                <label for="slide01" class="left"></label>
                                <label for="slide03" class="right"></label>
                            </div>
                            <div>
                                <label for="slide02" class="left"></label>
                                <label for="slide04" class="right"></label>
                            </div>
                            <div>
                                <label for="slide03" class="left"></label>
                                <label for="slide01" class="right"></label>
                            </div>
                        </div>

                    </ul>
                    <!-- 페이징 -->
                    <ul class="slide-pagelist">
                        <li><label for="slide01"></label></li>
                        <li><label for="slide02"></label></li>
                        <li><label for="slide03"></label></li>
                        <li><label for="slide04"></label></li>
                    </ul>
                </div>
            </div>
            <div class="main_multi">
                <div class="main_go">
                    <p>바로가기</p>
                    <div class="line_one">
                        <input type="button" class="button" onclick="location.href='/rank'">
                        <input type="button" class="button" onclick="location.href='/notice'" value="공지사항">
                        <input type="button" class="button" onclick="location.href='/report'" value="신고 및 건의">
                        <input type="button" class="button" onclick="location.href='#'" value="">
                    </div>
                    <div class="line_two">
                        <input type="button" class="button" onclick="location.href='e/'" value="작품 생성">
                        <input type="button" class="button" onclick="location.href='ea/'" value="작가 생성">
                        <input type="button" class="button" onclick="location.href='ep/'" value="출판사 생성">
                        <input type="button" class="button" onclick="location.href='#'" value=" ">
                    </div>
                </div>
                <div class="main_new_document">
                    <a href="#">새로 등록된 작품</a>
                    <div class="document_first" id="new_document_limit4">
                        <!-- <div class="document_second">
                            <a href="novel.html">
                                <img src="./image/표지_미등록.png">
                                <p>첫번째</p>
                            </a>
                        </div> -->
                    </div>

                </div>
            </div>
        </div>

        <div class="main_intro">
            <div class="explain">
                <!--<hr />-->
                <p>NovelPedia는 누구나 자유롭게 이용할 수 있습니다.</p>
                <p>정식 출간되지 않은 작품도 문서로 등록할 수 있으며, 직접 문서를 고치고 리뷰를 작성할 수 있습니다.</p>
                <!--<hr />-->
            </div>
        </div>

        <div class="main_second">
            <div class="main_ranking">
                <div class="select_div">
                    <a href="/rank">노벨피디아 순위</a>
                    <select id="sort_value">
                        <option value="view" selected>조회수</option>
                        <option value="like">좋아요수</option>
                        <option value="review">리뷰수</option>
                    </select>
                </div>

                <div class="document_rank_first">
                </div>

                <!-- <div class="document_rank2">
                    <a href="#" class="a_first"></a>
                </div> -->

                <div class="document_rank_second">
                </div>
            </div>
            <div class="main_new_review" id="recent_modify_parent">
                <div class="name">
                    <a>최근 수정된 문서</a>
                    <select onchange="recent_modify_document()" id="select_nap">
                        <option value="1">작품</option>
                        <option value="2">작가</option>
                        <option value="3">출판사</option>
                    </select>
                </div>
                <div class="modify_document" id="recent_modify">
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col">
                    <ul>
                        <li><a href="/notice">공지사항</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <ul>
                        <li><a href="/report">신고 및 건의</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    
    
    <!--파이어베이스 연동 자바스크립트 파일-->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

    <!--제이쿼리-->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    
    <!--파이어베이스 정보 가져오기--><!--파이어베이스 연동 키값-->
    <script src="./js/information.js"></script>

    <!--로그인 상태 체크-->
    <script src="./js/login_check.js"></script>
    <!--로그아웃을 위한 소스코드-->
    <script src="./js/logout.js"></script>
    <!--로그아웃 상태일 때-->
    <script src="./js/logout_state.js"></script>

    <!-- 파이어베이스 데이터 출력 -->
    <script>
        const dbRef = db.collection("novel_document");
        
        dbRef.orderBy("the_first_date", "desc").limit(4).get().then((res)=>{
            /*res 안에 든 데이터의 갯수만큼 코드 반복*/
            res.forEach((doc)=>{
                // console.log(doc.data());
                var document_name = "n/" + doc.data().name + "(" + doc.data().author + ")";
                var doc_name_temp = doc.data().name;

                // 문자열이 너무 길어지면 문자열을 끊고 '...' 으로 이어지도록
                if(doc_name_temp.length>=5){
                    doc_name_temp = doc_name_temp.substr(0,4) + "...";
                }

                var temp = 
                    `<div class="document_second">
                            <a href="${document_name}">
                                <img src="${doc.data().bookcover}">
                                <p>${doc_name_temp}</p>
                            </a>
                        </div>`;
                    $('#new_document_limit4').append(temp);
            })
        })
    </script>

    <!-- 최근 수정된 문서 -->
    <script>
        dbRef.orderBy("update_date", "desc").limit(10).get().then((res)=>{
            /*res 안에 든 데이터의 갯수만큼 코드 반복*/
            res.forEach((doc)=>{
                // console.log(doc.data());
                var document_name = "n/" + doc.data().name + "(" + doc.data().author + ")";
                var doc_name_temp = doc.data().name;

                // 문자열이 너무 길어지면 문자열을 끊고 '...' 으로 이어지도록
                // if(doc_name_temp.length>=5){
                //     doc_name_temp = doc_name_temp.substr(0,4) + "...";
                // }

                var temp = 
                    `<a href="${document_name}">
                        <p>${doc_name_temp}</p>
                    </a>`;
                    $('#recent_modify').append(temp);
            })
        })

        function recent_modify_document(){
            document.getElementById("recent_modify").remove();
            var select_sort = document.getElementById("select_nap").value;

            var recent_modify_temp = `<div class="modify_document" id="recent_modify"></div>`;
            $('#recent_modify_parent').append(recent_modify_temp);

            if(select_sort == 1){
                db.collection("novel_document").orderBy("update_date", "desc").limit(10).get().then((res)=>{
                    res.forEach((doc)=>{
                        // console.log(doc.data());
                        var document_name = "n/" + doc.data().name + "(" + doc.data().author + ")";
                        var doc_name_temp = doc.data().name;

                        var temp = 
                            `<a href="${document_name}">
                                <p>${doc_name_temp}</p>
                            </a>`;
                            $('#recent_modify').append(temp);
                    })
                })
            }
            else if(select_sort == 2){
                db.collection("author_document").orderBy("update_date", "desc").limit(10).get().then((res)=>{
                    res.forEach((doc)=>{
                        // console.log(doc.data());
                        var document_name = "a/" + doc.data().name + "(" + doc.data().birthday + ")";
                        var doc_name_temp = doc.data().name;

                        var temp = 
                            `<a href="${document_name}">
                                <p>${doc_name_temp}</p>
                            </a>`;
                            $('#recent_modify').append(temp);
                    })
                })
            }
            else{
                db.collection("publisher_document").orderBy("update_date", "desc").limit(10).get().then((res)=>{
                    res.forEach((doc)=>{
                        // console.log(doc.data());
                        var document_name = "p/" + doc.data().name;
                        var doc_name_temp = doc.data().name;

                        var temp = 
                            `<a href="${document_name}">
                                <p>${doc_name_temp}</p>
                            </a>`;
                            $('#recent_modify').append(temp);
                    })
                })
            }

        }



        const sortValue = document.querySelector("#sort_value");
        let select_name = 'view';

        updateList();

        sortValue.addEventListener('change', (event) => {
            if (event.target.value == 'view'){
                select_name = 'view';
            } else if (event.target.value == 'like'){
                select_name = 'like';
            } else if (event.target.value == 'review'){
                select_name = 'star_count'
            }

            updateList();
        });
        
        // 데이터 출력
        function updateList() {
            db.collection("novel_document").orderBy(select_name, 'desc').limit(10).get().then((querySnapshot) => {

                $('.document_rank_first').empty();
                $('.document_rank_second').empty();
                
                let index = 1; // 순위 번호
                querySnapshot.forEach((doc) => {
                    let doc_name = doc.data().name;
                    let doc_name2 = doc.data().name;
            
                    if(doc_name.length > 7) {
                        doc_name = doc_name.substr(0, 6) + "⋯";
                    }
                    if(doc_name2.length > 15) {
                        doc_name2 = doc_name2.substr(0, 14) + "⋯";
                    }
                    var temp = `
                    <div class="document_rank">
                        <a href="https://novelpedia.co.kr/n/${doc.data().name+"("+doc.data().author+")"}">
                            <img class="rankimg" src="./image/rank${index}.png">
                            <img class="coverimg" src="${doc.data().bookcover}">
                            <p>${index}위</p>
                            <p class="doc_name">${doc_name}</p>
                            <p>${doc.data().author}</p>
                        </a>
                    </div>`;
                    if(index >=4 && index <= 10){
                        var temp = `
                            <div class="document_rank2">
                                <a href="https://novelpedia.co.kr/n/${doc.data().name+"("+doc.data().author+")"}">
                                    <p class="p_rank">${index}위</p>
                                    <p class="p_title">${doc_name2}</p>
                                    <p class="p_writer">${doc.data().author}</p>
                                </a>
                            </div>
                            `;
                    }
                    index++;
                    // 콘솔창에 데이터 정보 출력
                    // console.log(doc.id, doc.data());
                    if(index <= 4) {
                        $(".document_rank_first").append(temp);
                    } else {
                        $(".document_rank_second").append(temp);
                    }
                })
            }).catch((err) => {
                console.log(err);
            });
        }
    </script>

    <!--검색창-->
    <!-- <script src="./js/search.js"></script> -->
</body>

</html>