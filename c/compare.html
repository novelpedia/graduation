<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/footer.css" rel="stylesheet">
    <link href="../css/getOther.css" rel="stylesheet">
    <link href="../css/compare.css" rel="stylesheet">
    <title>작품 편집</title>
</head>

<body>
    <header class="header">
        <a class="logo_a" href="https://novelpedia.co.kr/">
            <!--<img class="logo" src="./image/novelpedia.png" height="40px">-->
            <img class="logo_icon" src="../image/logo.png">
        </a>
        <div class="first_line">
            <div class="inner_item">
                <a id="open_close" href="#" class="navbar_toggleBtn">
                    <img id="close" src="../image/메뉴_검정_버튼.png">
                </a>
                <div class="inner_inner_item">
                    <div class="search">
                        <div class="icon"></div>
                        <form method="get" action="../search">
                            <div class="input">
                                <input type="text" placeholder="Search" id="mysearch" name="q">
                            </div>
                            <span class="clear" onclick="document.getElementById('mysearch').value = ''"></span>
                            <input type="submit" value="" class="search_btn">
                        </form>
                    </div>
                </div>
            </div>
            <div class="set">
                <div class="set_mid">
                    <ul class="bar_menu">
                        <input type="checkbox" id="list_open">
                        <label for="list_open" class="list_page_label">
                            <li class="list_li">목록페이지</li>
                            <div class="header_list">
                                <div class="header_set1">
                                    <div class="header_picture"><a href="../list/novel">작품</a></div>
                                </div>
                                <div class="header_set1">
                                    <div class="header_author"><a href="../list/author">작가</a></div>
                                </div>
            
                                <div class="header_set1">
                                    <div class="header_publisher"><a href="../list/publisher">출판사</a></div>
                                </div>
                            </div>
                        </label>
                        <li class="mypage_header" id="mypage_button"><a href="../mypage">마이페이지</a></li>
                        <li><a href="../login" id="login_logout">Login</a></li>
                    </ul>
                </div>
            </div>
        </div>

    </header>

    <script>
        /*메뉴버튼 바꾸기 위한 변수*/
        const change_img = document.createElement('img');
        change_img.setAttribute('src', '../image/메뉴_닫힘.png');
        change_img.setAttribute('id', 'close');

        const change_img_normal = document.createElement('img');
        change_img_normal.setAttribute('src', '../image/메뉴_검정_버튼.png');
        change_img_normal.setAttribute('id', 'close');

        /*검색버튼에 대한 동작 변수*/
        const icon = document.querySelector('.search .icon');
        const search = document.querySelector('.search');
        const inner_item = document.querySelector('.inner_item');
        const inner_inner_item = document.querySelector('.inner_inner_item');
        const menu_window2 = document.querySelector('.header .set active');

        /*메뉴 버튼에 따른 동작 변수*/
        const toggleBtn = document.querySelector('.navbar_toggleBtn');
        const menu = document.querySelector('.bar_menu');
        const menu_window = document.querySelector('.header .set');

        /*메뉴버튼*/
        toggleBtn.onclick = function() {
            menu.classList.toggle('active');
            menu_window.classList.toggle('active');
            const lastDiv = document.getElementById('close');
            /*메뉴창 열림 여부에 따라 버튼 이미지 교체*/
            if (document.querySelector('.header .set').classList.contains('active')) {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img);
            } else {
                document.getElementById('open_close').removeChild(lastDiv);
                document.getElementById('open_close').appendChild(change_img_normal);
            }

        }

        /*검색버튼*/
        icon.onclick = function() {
            icon.classList.toggle('active');
            search.classList.toggle('active');
            inner_item.classList.toggle('active');
            inner_inner_item.classList.toggle('active');
            menu_window.classList.toggle('search_active');
        }
    </script>

    <section class="document_item">
        <div class="document_name">
            <a href="#" id="document_name">작품제목(작가명)</a>
        </div>
        <div class="page_title">
            <h4>[문서 정보 비교]</h4>
        </div>
        <div class="compare_set">
            <form>
                <div class="document_critical_edit_1">
                    <!-- 버전 정보 -->
                    <label id="version_a">v1</label>
                    <!--표지-->
                    <div class="document_bookcover_edit">
                        <label for="bookcover_file">표지</label>
                        <img id="bookcover_preview" class="bookcover_preview" for="bookcover_file" src="../image/표지_미등록.png">
                    </div>
                    <!--제목-->
                    <div class="document_name_edit">
                        <label for="name">제목</label>
                        <input id="name" type="text" autocomplete="off" disabled>
                    </div>
                    <!--작가명-->
                    <div class="document_author_edit">
                        <label for="author">작가</label>
                        <input id="author" type="text" autocomplete="off" disabled>
                    </div>
                    <!--생년월일-->
                    <div class="document_birthday_edit">
                        <label for="birthday">작가 생년월일</label>
                        <input id="birthday" type="date" autocomplete="off" disabled>
                    </div>
                    <!--출판사-->
                    <div class="document_publisher_edit">
                        <label for="publisher">출판사</label>
                        <input id="publisher" type="text" autocomplete="off" disabled>
                    </div>
                    <!-- 분류선택 -->
                    <!-- 장르 디자인 그대로 사용 -->
                    <div class="document_genre_edit"> 
                        <label for="n_category">분류</label>
                        <input id="n_category" type="text" autocomplete="off" disabled>
                    </div>
                    <!--장르선택-->
                    <div class="document_genre_edit">
                        <label for="genre">장르</label>
                        <input id="genre" type="text" autocomplete="off" disabled>
                    </div>
                    <!--구매처 및 연재처-->
                    <div class="document_sale_edit">
                        <div class="sale_name">
                            <label for="sale_name">구매처 및 연재처</label>
                            <input id="sale_name" type="text" autocomplete="off" disabled>
                        </div>
                        <div class="sale_address">
                            <label for="sale_address">주소</label>
                            <input id="sale_address" type="text" autocomplete="off" disabled>
                        </div>
                    </div>
                    <!--출간일-->
                    <div class="document_publishdate_edit">
                        <label for="publishdate">출간일</label>
                        <input id="publishdate" type="date" autocomplete="off" disabled>
                    </div>
                    <!--줄거리-->
                    <div class="document_summary_edit">
                        <label for="summary">줄거리</label>
                        <textarea id="summary" disabled></textarea>
                    </div>
                    <!--태그-->
                    <div class="document_tag_edit">
                        <label for="tag">태그</label>
                        <input id="tag" type="text" autocomplete="off" disabled>
                    </div>
                    <div class="document_other">
                        <label for="document_other">사용자편집영역</label>
                        <div class="other" id="document_other" disabled></div>
                    </div>
                </div>
            </form>

            <form>
                <div class="document_critical_edit_2">
                    <!-- 버전 정보 -->
                    <label id="version_b">v2</label>
                    <!--표지-->
                    <div class="document_bookcover_edit">
                        <label for="bookcover_file">표지</label>
                        <img id="bookcover_preview_2" class="bookcover_preview" for="bookcover_file" src="../image/표지_미등록.png">
                    </div>
                    <!--제목-->
                    <div class="document_name_edit">
                        <label for="name_2">제목</label>
                        <input id="name_2" type="text" autocomplete="off" disabled>
                    </div>
                    <!--작가명-->
                    <div class="document_author_edit">
                        <label for="author_2">작가</label>
                        <input id="author_2" type="text" autocomplete="off" disabled>
                    </div>
                    <!--생년월일-->
                    <div class="document_birthday_edit">
                        <label for="birthday_2">작가 생년월일</label>
                        <input id="birthday_2" type="date" autocomplete="off" disabled>
                    </div>
                    <!--출판사-->
                    <div class="document_publisher_edit">
                        <label for="publisher_2">출판사</label>
                        <input id="publisher_2" type="text" autocomplete="off" disabled>
                    </div>
                    <!-- 분류선택 -->
                    <!-- 장르 디자인 그대로 사용 -->
                    <div class="document_genre_edit"> 
                        <label for="n_category_2">분류</label>
                        <input id="n_category_2" type="text" autocomplete="off" disabled>
                    </div>
                    <!--장르선택-->
                    <div class="document_genre_edit">
                        <label for="genre_2">장르</label>
                        <input id="genre_2" type="text" autocomplete="off" disabled>
                    </div>
                    <!--구매처 및 연재처-->
                    <div class="document_sale_edit">
                        <div class="sale_name">
                            <label for="sale_name_2">구매처 및 연재처</label>
                            <input id="sale_name_2" type="text" autocomplete="off" disabled>
                        </div>
                        <div class="sale_address">
                            <label for="sale_address_2">주소</label>
                            <input id="sale_address_2" type="text" autocomplete="off" disabled>
                        </div>
                    </div>
                    <!--출간일-->
                    <div class="document_publishdate_edit">
                        <label for="publishdate_2">출간일</label>
                        <input id="publishdate_2" type="date" autocomplete="off" disabled>
                    </div>
                    <!--줄거리-->
                    <div class="document_summary_edit">
                        <label for="summary_2">줄거리</label>
                        <textarea id="summary_2" disabled></textarea>
                    </div>
                    <!--태그-->
                    <div class="document_tag_edit">
                        <label for="tag_2">태그</label>
                        <input id="tag_2" type="text" autocomplete="off" disabled>
                    </div>
                    <div class="document_other">
                        <label for="document_other_2">사용자편집영역</label>
                        <div class="other" id="document_other_2" disabled></div>
                    </div>
                </div>
                <!--사용자편집영역-->
                
                <!--각종버튼-->
                <!-- <div class="button_bundle">
                    <input class="save" id="send" type="button" value="저장">
                    <a onclick="history.back()">취소</a>
                    <input type="button" value="취소">
                    <a class="delete" href="#">삭제</a>
                </div> -->
            </form>
        </div>


    </section>

    <script>
        function loadFile(input) {
            var file = input.files[0];
            var changeImage = document.getElementById("bookcover_preview");
            changeImage.src = URL.createObjectURL(file);
        };
    </script>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col">
                    <ul>
                        <li><a href="#">공지사항</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <ul>
                        <li><a href="#">Q&A</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <ul>
                        <li><a href="#">의견보내기</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="../js/information.js"></script>

    <!--로그인 상태 체크-->
    <script src="../js/login_check.js"></script>
    <!--로그아웃을 위한 소스코드-->
    <script src="../js/logout.js"></script>
    <!--로그아웃 상태일 때-->
    <script src="../js/logout_state.js"></script>

    <!--태그 입력-->
    <script src="../js/tag.js"></script>

    <!-- 주소창에서 url 정보 받아오기 -->
    <script>
        const path_url = window.location.pathname;
        const path_decode = decodeURI(path_url);
        let document_name = path_decode.split('/');
    </script>

    <script>
        var document_url_version = document_name[2].split('=');
        document_name[2] = document_url_version[0];
        var document_url_recent_old = document_url_version[1].split('&');

        

        // [0]에는 항상 작은 수가 들어가도록
        if(document_url_recent_old[0]>document_url_recent_old[1]){
            var temp_number;
            temp_number = document_url_recent_old[0];
            document_url_recent_old[0] = document_url_recent_old[1];
            document_url_recent_old[1] = temp_number;
        }

        docPath = db.collection('history').doc(document_name[2]).collection('version').doc(document_url_recent_old[0]);
        docPath2 = db.collection('history').doc(document_name[2]).collection('version').doc(document_url_recent_old[1]);

        document.getElementById('document_name').innerText = document_name[2];
        document.getElementById("document_name").href = "../n/" + document_name[2];

        // 타이틀 변경
        console.log(document_name[2]);
        document.title = document_name[2];

        // docPath = db.collection('history').doc("Users(None)").collection('version');

        var a_b;
        var p;
        var n_c;
        var g;
        var b_s;
        var b_a;
        var p_d;
        var s;
        var t;
        var o;
        
        docPath.get().then((결과) => {
            // 불러온 내용 바탕으로 내용 바꾸기
            console.log(document_name[2]);
            console.log(결과.data());           

            // 저장해서 비교할 변수
            a_b = 결과.data().author_birthday;
            p = 결과.data().publisher;
            n_c = 결과.data().n_category;
            g = 결과.data().genre;
            b_s = 결과.data().buy_series;;
            b_a = 결과.data().address;
            p_d = 결과.data().publish_date;
            s = 결과.data().summary;
            o = 결과.data().other;
            
            
            // 추후에 입력, 순서대로 좋아요개수, 업로드 날짜, 조회수, 태그, 기타
            var document_update_date = 결과.data().update_date;
            var document_tag = 결과.data().tag;
            var document_other = 결과.data().other;
            var document_version = 결과.data().version;
            var document_the_first_date = 결과.data().the_first_date;
            var document_category = 결과.data().category;

            document.getElementById("version_a").innerText = "v" + 결과.data().version;
            document.getElementById("bookcover_preview").src = 결과.data().bookcover;
            document.getElementById("name").value = 결과.data().name;
            document.getElementById("author").value = 결과.data().author;
            document.getElementById("birthday").value = 결과.data().author_birthday;
            document.getElementById("publisher").value = 결과.data().publisher;
            document.getElementById("n_category").value = 결과.data().n_category;
            document.getElementById("genre").value = 결과.data().genre;
            document.getElementById("sale_name").value = 결과.data().buy_series;;
            document.getElementById("sale_address").value = 결과.data().address;
            document.getElementById("publishdate").value = 결과.data().publish_date;
            document.getElementById("summary").value = 결과.data().summary;

            var tag_value = "";
            // 태그 입력
            document_tag.forEach(function(tag_element){
                tag_value = tag_value + "#" + tag_element;
            });

            document.getElementById("tag").value = tag_value;
            t = tag_value;

            // document.getElementById("tag").value = document_tag;
            document.getElementById("document_other").innerHTML = document_other;
        }).catch((err) => {
            console.log(err);
        });

        var a_b_2;
        var p_2;
        var n_c_2;
        var g_2;
        var b_s_2;
        var b_a_2;
        var p_d_2;
        var s_2;
        var t_2;
        var o_2

        docPath2.get().then((결과) => {
            // 불러온 내용 바탕으로 내용 바꾸기
            console.log(document_name[2]);
            console.log(결과.data());           

            a_b_2 = 결과.data().author_birthday;
            p_2 = 결과.data().publisher;
            n_c_2 = 결과.data().n_category;
            g_2 = 결과.data().genre;
            b_s_2 = 결과.data().buy_series;;
            b_a_2 = 결과.data().address;
            p_d_2 = 결과.data().publish_date;
            s_2 = 결과.data().summary;
            o_2 = 결과.data().other;
            
            // 추후에 입력, 순서대로 좋아요개수, 업로드 날짜, 조회수, 태그, 기타
            var document_update_date = 결과.data().update_date;
            var document_tag = 결과.data().tag;
            var document_other = 결과.data().other;
            var document_version = 결과.data().version;
            var document_the_first_date = 결과.data().the_first_date;
            var document_category = 결과.data().category;

            document.getElementById("version_b").innerText = "v" + 결과.data().version;
            document.getElementById("bookcover_preview_2").src = 결과.data().bookcover;
            document.getElementById("name_2").value = 결과.data().name;
            document.getElementById("author_2").value = 결과.data().author;
            document.getElementById("birthday_2").value = 결과.data().author_birthday;
            document.getElementById("publisher_2").value = 결과.data().publisher;
            document.getElementById("n_category_2").value = 결과.data().n_category;
            document.getElementById("genre_2").value = 결과.data().genre;
            document.getElementById("sale_name_2").value = 결과.data().buy_series;;
            document.getElementById("sale_address_2").value = 결과.data().address;
            document.getElementById("publishdate_2").value = 결과.data().publish_date;
            document.getElementById("summary_2").value = 결과.data().summary;

            var tag_value = "";
            // 태그 입력
            document_tag.forEach(function(tag_element){
                tag_value = tag_value + "#" + tag_element;
            });

            document.getElementById("tag_2").value = tag_value;
            t_2 = tag_value;
            document.getElementById("document_other_2").innerHTML = document_other;
            compare_change();
        }).catch((err) => {
            console.log(err);
        });


        function compare_change(){
            if(a_b_2 != a_b){
                document.getElementById("birthday_2").style.backgroundColor = "#daffda";
            }
            if(p_2 != p){
                document.getElementById("publisher_2").style.backgroundColor = "#daffda";
            }
            if(n_c_2 != n_c){
                document.getElementById("n_category_2").style.backgroundColor = "#daffda";
            }
            if(g_2 != g){
                document.getElementById("genre_2").style.backgroundColor = "#daffda";
            }   
            if(b_s_2 != b_s){
                document.getElementById("sale_name_2").style.backgroundColor = "#daffda";
            }
            if(b_a_2 != b_a){
                document.getElementById("sale_address_2").style.backgroundColor = "#daffda";
            }
            if(p_d_2 != p_d){
                document.getElementById("publishdate_2").style.backgroundColor = "#daffda";
                
            }
            if(s_2 != s){
                document.getElementById("summary_2").style.backgroundColor = "#daffda";
            }
            if(t_2 != t){
                document.getElementById("tag_2").style.backgroundColor = "#daffda";
            }
            if(o_2 != o){
                document.getElementById("document_other_2").style.backgroundColor = "#daffda";
            }
        }
    </script>  
        

    
</body>

</html>